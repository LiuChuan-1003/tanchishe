<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•ç‰ˆè´ªåƒè›‡</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #2c3e50;
            color: white;
            font-family: sans-serif;
        }
        canvas {
            background-color: #000;
            border: 2px solid #ecf0f1;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        #debug {
            margin-top: 20px;
            color: yellow;
            font-size: 18px;
            background: rgba(0,0,0,0.5);
            padding: 10px;
        }
    </style>
</head>
<body>

    <h1>ğŸ è´ªåƒè›‡ (è‡ªåŠ¨å¯åŠ¨ç‰ˆ)</h1>
    <h2 id="scoreBoard">å¾—åˆ†: 0</h2>
    
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    
    <div id="debug">è¯·å…ˆç”¨é¼ æ ‡ç‚¹å‡»é»‘è‰²åŒºåŸŸï¼Œç„¶åæŒ‰æ–¹å‘é”®</div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        const gridSize = 20;
        const tileCount = 20; 
        
        let score = 0;
        
        // --- ä¿®æ”¹ç‚¹ï¼šåˆå§‹ä½ç½®æ”¾åœ¨ä¸­é—´ ---
        let headX = 10;
        let headY = 10;
        
        const snakeParts = [];
        let tailLength = 2; 

        let appleX = 5;
        let appleY = 5;

        // --- ä¿®æ”¹ç‚¹ï¼šè®©å®ƒé»˜è®¤å°±å¾€å³èµ° (1) ---
        let xVelocity = 1; 
        let yVelocity = 0;

        function drawGame() {
            changeSnakePosition();
            
            // ç®€å•çš„æ’å¢™æ£€æµ‹ï¼šæ’å¢™å°±åœä¸‹ï¼Œè€Œä¸æ˜¯æŠ¥é”™
            if(headX < 0 || headX >= tileCount || headY < 0 || headY >= tileCount) {
                document.getElementById("debug").innerText = "ğŸ’€ æ’å¢™äº†ï¼åˆ·æ–°ç½‘é¡µé‡æ¥";
                return; 
            }

            clearScreen();
            checkAppleCollision();
            drawApple();
            drawSnake();
            drawScore();

            setTimeout(drawGame, 1000 / 7);
        }

        function clearScreen() {
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function drawSnake() {
            ctx.fillStyle = "lime"; 
            for (let i = 0; i < snakeParts.length; i++) {
                let part = snakeParts[i];
                ctx.fillRect(part.x * gridSize, part.y * gridSize, gridSize - 2, gridSize - 2);
            }

            snakeParts.push({x: headX, y: headY});
            while (snakeParts.length > tailLength) {
                snakeParts.shift(); 
            }

            ctx.fillStyle = "orange";
            ctx.fillRect(headX * gridSize, headY * gridSize, gridSize - 2, gridSize - 2);
        }

        function changeSnakePosition() {
            headX = headX + xVelocity;
            headY = headY + yVelocity;
        }

        function drawApple() {
            ctx.fillStyle = "red";
            ctx.fillRect(appleX * gridSize, appleY * gridSize, gridSize - 2, gridSize - 2);
        }

        function checkAppleCollision() {
            if (appleX === headX && appleY === headY) {
                appleX = Math.floor(Math.random() * tileCount);
                appleY = Math.floor(Math.random() * tileCount);
                tailLength++;
                score++;
                document.getElementById("debug").innerText = "ğŸ åƒåˆ°è‹¹æœäº†ï¼";
            }
        }

        function drawScore() {
            document.getElementById("scoreBoard").innerText = "å¾—åˆ†: " + score;
        }

        // --- é”®ç›˜æ§åˆ¶ (å¸¦å±å¹•åé¦ˆ) ---
        document.body.addEventListener("keydown", keyDown);

        function keyDown(event) {
            // åœ¨å±å¹•ä¸Šæ˜¾ç¤ºä½ æŒ‰äº†ä»€ä¹ˆé”®ï¼Œæ–¹ä¾¿è°ƒè¯•
            document.getElementById("debug").innerText = "ä½ æŒ‰ä¸‹äº†: " + event.key;

            // å‘ä¸Š
            if (event.key === "ArrowUp" || event.key === "w") {
                if (yVelocity == 1) return;
                yVelocity = -1;
                xVelocity = 0;
            }
            // å‘ä¸‹
            if (event.key === "ArrowDown" || event.key === "s") {
                if (yVelocity == -1) return;
                yVelocity = 1;
                xVelocity = 0;
            }
            // å‘å·¦
            if (event.key === "ArrowLeft" || event.key === "a") {
                if (xVelocity == 1) return;
                yVelocity = 0;
                xVelocity = -1;
            }
            // å‘å³
            if (event.key === "ArrowRight" || event.key === "d") {
                if (xVelocity == -1) return;
                yVelocity = 0;
                xVelocity = 1;
            }
        }

        drawGame(); 
    </script>
</body>
</html>